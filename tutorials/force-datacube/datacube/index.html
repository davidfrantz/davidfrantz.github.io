<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.6.3">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="David Frantz">

  
  
  
    
  
  <meta name="description" content="This tutorial explains what a datacube is, how it is parameterized, how you can find a POI, how to visualize the tiling grid, and how to conveniently display cubed data">

  
  <link rel="alternate" hreflang="en-us" href="https://davidfrantz.github.io/tutorials/force-datacube/datacube/">

  


  
  
  
  <meta name="theme-color" content="#5C9DE3">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    

    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap">
  

  
  
  
  
  <link rel="stylesheet" href="/css/academic.css">

  




  


  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon-32.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="https://davidfrantz.github.io/tutorials/force-datacube/datacube/">

  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary">
  
  <meta property="og:site_name" content="DAVID FRANTZ">
  <meta property="og:url" content="https://davidfrantz.github.io/tutorials/force-datacube/datacube/">
  <meta property="og:title" content="FORCE Tutorial: The Datacube | DAVID FRANTZ">
  <meta property="og:description" content="This tutorial explains what a datacube is, how it is parameterized, how you can find a POI, how to visualize the tiling grid, and how to conveniently display cubed data"><meta property="og:image" content="https://davidfrantz.github.io/img/icon-192.png">
  <meta property="twitter:image" content="https://davidfrantz.github.io/img/icon-192.png"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2020-02-09T00:00:00&#43;00:00">
    
    <meta property="article:modified_time" content="2020-02-09T00:00:00&#43;00:00">
  

  



  


  


  





  <title>FORCE Tutorial: The Datacube | DAVID FRANTZ</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  

<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/">DAVID FRANTZ</a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/">DAVID FRANTZ</a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-center" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#about"><span>Home</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#experience"><span>CV</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#projects"><span>Projects</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#publications"><span>Publications</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#presentations"><span>Presentations</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#data"><span>Data</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#software"><span>Software</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#tutorials"><span>Tutorials</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#contact"><span>Contact</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      
      <li class="nav-item">
        <a class="nav-link js-dark-toggle" href="#"><i class="fas fa-moon" aria-hidden="true"></i></a>
      </li>
      

      

    </ul>

  </div>
</nav>


  <article class="article">

  












  

  
  
  
<div class="article-container pt-3">
  <h1>FORCE Tutorial: The Datacube</h1>

  
  <p class="page-subtitle">How to handle cubed data</p>
  

  
    


<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
    
    Feb 9, 2020
  </span>
  

  

  

  
  
  

  
  

</div>

    














  
</div>



  <div class="article-container">

    <div class="article-style">
      <p><em>This tutorial uses FORCE v. 3.0</em></p>
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
<h2 id="learning-objective"><strong>Learning Objective</strong></h2>
<p>This tutorial explains what a datacube is, how it is parameterized, how you can find a POI, how to visualize the tiling grid, and how to conveniently display cubed data.</p>
<h2 id="background"><strong>Background</strong></h2>
<p>FORCE makes heavy use of the data cube concept. This includes two main points:</p>
<ol>
<li>All data are in the <strong>same coordinate system</strong>, which should be valid for a large regional extent (e.g. a continental projection).</li>
<li>The data are organized in regular, non-overlapping <strong>tiles</strong>.</li>
</ol>



  











<figure>


  <a data-fancybox="" href="/img/tutorial-datacube-scheme.jpg" data-caption="Overview of the datacube concept in FORCE">
<img src="/img/tutorial-datacube-scheme.jpg" alt="" ></a>


  
  
  <figcaption>
    Overview of the datacube concept in <strong>FORCE</strong>
  </figcaption>


</figure>

<blockquote>
<ul>
<li>The ‘grid’ is the regular spatial subdivision of the land surface in the target coordinate system.</li>
<li>The ‘grid origin’ is the location, where the tile numbering starts with zero. Tile numbers increase toward the South and East. Although not recommended, negative tile numbers may be present if the tile origin is not North–West of the study area.</li>
<li>The ‘tile’ is one entity of the grid, i.e., a grid cell with a unique tile identifier, e.g., X0003_Y0002. The tile is stationary, i.e., it always covers the same extent on the land surface.</li>
<li>The ‘tile size’ is defined in target coordinate system units (most commonly in meters). Tiles are square.</li>
<li>Each ‘original image’ is partitioned into several ‘chips’, i.e., any original image is intersected with the grid and then tiled into chips.</li>
<li>Chips are grouped in ‘datasets’, which group data, e.g. according to acquisition date and sensor.</li>
<li>The ‘data cube’ groups all datasets within a tile in a time-ordered manner. The data cube may contain data from several sensors and different resolutions. Thus, the pixel size is allowed to vary, but the tile extent stays fixed. The tile size must be a multiple of the resolutions. Other data like features or auxiliary data are also permitted in the data cube (e.g. DEM or climate variables).</li>
<li>The data cube concept allows for non-redundant data storage and efficient data access, as well as simplified extraction of data and information.</li>
</ul>
</blockquote>
<h2 id="how-to-define-the-datacube-parameters"><strong>How to define the datacube parameters?</strong></h2>
<p>When generating Level 2 ARD data with <strong>FORCE L2PS</strong>, you need to define the datacube in the parameter file. Empty parameter files can be generated with <code>force-parameter</code>.</p>
<ul>
<li><code>DO_REPROJ</code> indicates whether the images should be reprojected to the target coordinate system - or stay in their original UTM projection.</li>
<li><code>DO_TILE</code> indicates whether the images should be tiled to chips that intersect with the grid system - or stay in the original reference system (WRS-2/MGRS).</li>
<li><code>PROJECTION</code> defines the target coordinate system. This projection should ideally be valid for a large geographic extent. The projection needs to given as &ldquo;WKT&rdquo; string. You can verify your projection (and convert to WKT from another format) using <code>gdalsrsinfo</code> (see below). If this fails, you need to fix the projection - otherwise <strong>FORCE L2PS</strong> will likely fail, too.</li>
<li><code>ORIGIN_LAT</code> and <code>ORIGIN_LON</code> are the origin coordinates of the grid system in decimal degree. The upper left corner of tile X0000_Y0000 represents this point. It is a good choice to use a coordinate that is North-West of your study area – to avoid negative tile numbers.</li>
<li><code>TILE_SIZE</code> is the tile size (in target units, commonly in meters). Tiles are square.</li>
<li><code>BLOCK_SIZE</code> is the block size (in target units, commonly in meters) of the image chips. Blocks are stripes, i.e. they are as wide as the tile and as high as specified here. The blocks represent the internal structure of the GeoTiffs, and represent the primary processing unit of the force-higher-level routines.</li>
</ul>
<p>Two default projection / grid systems are predefined in <strong>FORCE</strong>. They can be specified via the <code>PROJECTION</code> parameter instead of giving a WKT string. The predefined options have their own settings for <code>ORIGIN_LAT</code>, <code>ORIGIN_LON</code>, <code>TILE_SIZE</code>, and <code>BLOCK_SIZE</code>, thus the values given in the parameterfile will be ignored. <a href="https://cartography.tuwien.ac.at/eurocarto/wp-content/uploads/2015/09/3_6_ppt.pdf">EQUI7</a> consists of 7 Equi-Distant, continental projections with a tile size of 100km. <a href="https://measures-glance.github.io/glance-grids/">GLANCE7</a> consists of 7 Equal-Area, continental projections, with a tile size of 150km. One datacube will be generated for each continent.</p>
<p><em>If you are not using the datacube options, i.e. <code>DO_REPROJ = FALSE</code> or <code>DO_TILE = FALSE</code>, you are running into a <strong>dead end</strong> for <strong>FORCE</strong>. In this case, the data cannot be further processed or analysed with any higher level FORCE functionality&hellip;</em></p>
<h2 id="how-to-validate-the-projection"><strong>How to validate the projection?</strong></h2>
<p>GDAL has a built-in projection conversion/validation tool:</p>
<pre><code class="language-bash">gdalsrsinfo -v 'PROJCS[&quot;ETRS89 / LAEA Europe&quot;,GEOGCS[&quot;ETRS89&quot;,DATUM[&quot;European_Terrestrial_Reference_System_1989&quot;,SPHEROID[&quot;GRS 1980&quot;,6378137,298.257222101,AUTHORITY[&quot;EPSG&quot;,&quot;7019&quot;]],TOWGS84[0,0,0,0,0,0,0],AUTHORITY[&quot;EPSG&quot;,&quot;6258&quot;]],PRIMEM[&quot;Greenwich&quot;,0,AUTHORITY[&quot;EPSG&quot;,&quot;8901&quot;]],UNIT[&quot;degree&quot;,0.0174532925199433,AUTHORITY[&quot;EPSG&quot;,&quot;9122&quot;]],AUTHORITY[&quot;EPSG&quot;,&quot;4258&quot;]],PROJECTION[&quot;Lambert_Azimuthal_Equal_Area&quot;],PARAMETER[&quot;latitude_of_center&quot;,52],PARAMETER[&quot;longitude_of_center&quot;,10],PARAMETER[&quot;false_easting&quot;,4321000],PARAMETER[&quot;false_northing&quot;,3210000],UNIT[&quot;metre&quot;,1,AUTHORITY[&quot;EPSG&quot;,&quot;9001&quot;]],AUTHORITY[&quot;EPSG&quot;,&quot;3035&quot;]]'
</code></pre>
<pre><code>Validate Succeeds

PROJ.4 : '+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs '

OGC WKT :
PROJCS[&quot;ETRS89 / LAEA Europe&quot;,
    GEOGCS[&quot;ETRS89&quot;,
        DATUM[&quot;European_Terrestrial_Reference_System_1989&quot;,
            SPHEROID[&quot;GRS 1980&quot;,6378137,298.257222101,
                AUTHORITY[&quot;EPSG&quot;,&quot;7019&quot;]],
            TOWGS84[0,0,0,0,0,0,0],
            AUTHORITY[&quot;EPSG&quot;,&quot;6258&quot;]],
        PRIMEM[&quot;Greenwich&quot;,0,
            AUTHORITY[&quot;EPSG&quot;,&quot;8901&quot;]],
        UNIT[&quot;degree&quot;,0.0174532925199433,
            AUTHORITY[&quot;EPSG&quot;,&quot;9122&quot;]],
        AUTHORITY[&quot;EPSG&quot;,&quot;4258&quot;]],
    PROJECTION[&quot;Lambert_Azimuthal_Equal_Area&quot;],
    PARAMETER[&quot;latitude_of_center&quot;,52],
    PARAMETER[&quot;longitude_of_center&quot;,10],
    PARAMETER[&quot;false_easting&quot;,4321000],
    PARAMETER[&quot;false_northing&quot;,3210000],
    UNIT[&quot;metre&quot;,1,
        AUTHORITY[&quot;EPSG&quot;,&quot;9001&quot;]],
    AUTHORITY[&quot;EPSG&quot;,&quot;3035&quot;]]
</code></pre>
<h2 id="where-is-the-datacube-definition-stored"><strong>Where is the datacube definition stored?</strong></h2>
<p>At the top level of the generated datacube, a text file will be generated (<code>datacube-definition.prj</code>). This file is key for all
<strong>FORCE</strong> higher-level functionality. Each higher-level module will save a copy of this file in the corresponding output directory. If this file is not present, the tools will fail. Therefore, <strong>do not modify, move, or delete this file</strong>. This file contains the datacube definition as defined above.</p>
<ol>
<li>projection in WKT</li>
<li>grid origin, longitude</li>
<li>grid origin, latitude</li>
<li>grid origin, x-coordinate in projection</li>
<li>grid origin, y-coordinate in projection</li>
<li>tile size in projection units</li>
<li>block size in projection units</li>
</ol>
<pre><code class="language-bash">cat /data/Dagobah/edc/level2/datacube-definition.prj
</code></pre>
<pre><code>PROJCS[&quot;ETRS89 / LAEA Europe&quot;,GEOGCS[&quot;ETRS89&quot;,DATUM[&quot;European_Terrestrial_Reference_System_1989&quot;,SPHEROID[&quot;GRS 1980&quot;,6378137,298.257222101,AUTHORITY[&quot;EPSG&quot;,&quot;7019&quot;]],TOWGS84[0,0,0,0,0,0,0],AUTHORITY[&quot;EPSG&quot;,&quot;6258&quot;]],PRIMEM[&quot;Greenwich&quot;,0,AUTHORITY[&quot;EPSG&quot;,&quot;8901&quot;]],UNIT[&quot;degree&quot;,0.0174532925199433,AUTHORITY[&quot;EPSG&quot;,&quot;9122&quot;]],AUTHORITY[&quot;EPSG&quot;,&quot;4258&quot;]],PROJECTION[&quot;Lambert_Azimuthal_Equal_Area&quot;],PARAMETER[&quot;latitude_of_center&quot;,52],PARAMETER[&quot;longitude_of_center&quot;,10],PARAMETER[&quot;false_easting&quot;,4321000],PARAMETER[&quot;false_northing&quot;,3210000],UNIT[&quot;metre&quot;,1,AUTHORITY[&quot;EPSG&quot;,&quot;9001&quot;]],AUTHORITY[&quot;EPSG&quot;,&quot;3035&quot;]]
-25.000000
60.000000
2456026.250000
4574919.500000
30000.000000
3000.0000000
</code></pre>
<p><em>In some rare circumstances, you might need to generate this file on your own. However, this only applies if - for any reason - you skip the Level 2 processing (e.g. if you only want to work with external features, or trick <strong>FORCE</strong> into using external ARD datasets).</em></p>
<h2 id="how-is-the-datacube-organized"><strong>How is the datacube organized?</strong></h2>
<p>In practice, the tiles are directories in the file system, and each chip represents one file.</p>
<pre><code class="language-bash">ls /data/Dagobah/edc/level2 | tail
</code></pre>
<pre><code>X0134_Y0095
X0134_Y0096
X0134_Y0097
X0134_Y0098
X0134_Y0099
X0135_Y0095
X0135_Y0096
X0135_Y0097
X0135_Y0098
X0135_Y0099
</code></pre>
<pre><code class="language-bash">ls /data/Dagobah/edc/level2/X0134_Y0097/*.tif | tail
</code></pre>
<pre><code>/data/Dagobah/edc/level2/X0134_Y0097/20181225_LEVEL2_SEN2A_BOA.tif
/data/Dagobah/edc/level2/X0134_Y0097/20181225_LEVEL2_SEN2A_CLD.tif
/data/Dagobah/edc/level2/X0134_Y0097/20181225_LEVEL2_SEN2A_HOT.tif
/data/Dagobah/edc/level2/X0134_Y0097/20181225_LEVEL2_SEN2A_QAI.tif
/data/Dagobah/edc/level2/X0134_Y0097/20181225_LEVEL2_SEN2A_VZN.tif
/data/Dagobah/edc/level2/X0134_Y0097/20181230_LEVEL2_SEN2B_BOA.tif
/data/Dagobah/edc/level2/X0134_Y0097/20181230_LEVEL2_SEN2B_CLD.tif
/data/Dagobah/edc/level2/X0134_Y0097/20181230_LEVEL2_SEN2B_HOT.tif
/data/Dagobah/edc/level2/X0134_Y0097/20181230_LEVEL2_SEN2B_QAI.tif
/data/Dagobah/edc/level2/X0134_Y0097/20181230_LEVEL2_SEN2B_VZN.tif
</code></pre>
<p>Within the tile, <strong>FORCE</strong> semantically groups files into datasets if they have the same sensor and date (e.g. multiple products like Bottom-of-Atmosphere reflectance <code>BOA</code> and Quality Assurance Information <code>QAI</code>).</p>
<pre><code class="language-bash">ls /data/Dagobah/edc/level2/X0134_Y0097/20181225_LEVEL2_SEN2A_*.tif
</code></pre>
<pre><code>/data/Dagobah/edc/level2/X0134_Y0097/20181225_LEVEL2_SEN2A_BOA.tif
/data/Dagobah/edc/level2/X0134_Y0097/20181225_LEVEL2_SEN2A_CLD.tif
/data/Dagobah/edc/level2/X0134_Y0097/20181225_LEVEL2_SEN2A_HOT.tif
/data/Dagobah/edc/level2/X0134_Y0097/20181225_LEVEL2_SEN2A_QAI.tif
/data/Dagobah/edc/level2/X0134_Y0097/20181225_LEVEL2_SEN2A_VZN.tif
</code></pre>
<p>It is important to note that chips in different tiles have the same filename, thus they can easily be mosaicked.</p>
<pre><code class="language-bash">ls /data/Dagobah/edc/level2/X*/20181225_LEVEL2_SEN2A_BOA.tif | wc -l
ls /data/Dagobah/edc/level2/X*/20181225_LEVEL2_SEN2A_BOA.tif | tail
</code></pre>
<pre><code>49
/data/Dagobah/edc/level2/X0133_Y0100/20181225_LEVEL2_SEN2A_BOA.tif
/data/Dagobah/edc/level2/X0134_Y0096/20181225_LEVEL2_SEN2A_BOA.tif
/data/Dagobah/edc/level2/X0134_Y0097/20181225_LEVEL2_SEN2A_BOA.tif
/data/Dagobah/edc/level2/X0134_Y0098/20181225_LEVEL2_SEN2A_BOA.tif
/data/Dagobah/edc/level2/X0134_Y0099/20181225_LEVEL2_SEN2A_BOA.tif
/data/Dagobah/edc/level2/X0135_Y0095/20181225_LEVEL2_SEN2A_BOA.tif
/data/Dagobah/edc/level2/X0135_Y0096/20181225_LEVEL2_SEN2A_BOA.tif
/data/Dagobah/edc/level2/X0135_Y0097/20181225_LEVEL2_SEN2A_BOA.tif
/data/Dagobah/edc/level2/X0135_Y0098/20181225_LEVEL2_SEN2A_BOA.tif
/data/Dagobah/edc/level2/X0135_Y0099/20181225_LEVEL2_SEN2A_BOA.tif
</code></pre>
<h2 id="i-processed-quite-some-data-there-are-many-many-tiles-how-do-i-find-a-poi"><strong>I processed quite some data. There are many, many tiles. How do I find a POI?</strong></h2>
<p>Given any coordinate \((\lambda,\phi)\), the computation of the corresponding tile is pretty straightforward.</p>
<ol>
<li>Convert the coordinate \((\lambda,\phi)\) to the projected coordinate \((X,Y)\)</li>
<li>Given the tile size \(t_s\) and the grid origin in projected coordinates \((X_O,Y_O)\), the tile ID can be computed as \(Tile_X = floor((X-X_O)/t_s)\) and \(Tile_Y = floor((Y_O-Y)/t_s)\)</li>
</ol>
<p>With some more math, you can also compute the exact pixel.</p>
<p>However, there is also a <strong>FORCE</strong> program that relieves you from doing this on your own:</p>
<pre><code class="language-bash">force-tile-finder
</code></pre>
<pre><code>usage: force-tile-finder datacube lon lat res
</code></pre>
<pre><code class="language-bash">force-tile-finder /data/Dagobah/edc/level2 13.404194 52.502889 10
</code></pre>
<pre><code>Point { LON/LAT (13.40,52.50) | X/Y (4552071.50,3271363.25) }
  is in tile X0069_Y0043 at pixel 2604/1355
</code></pre>
<p>Another useful <strong>FORCE</strong> program can generate a vector file (shapefile or kml) for convenient display of the tiles.</p>
<pre><code class="language-bash">force-tabulate-grid
</code></pre>
<pre><code>usage: force-tabulate-grid datacube bottom top left right format
             format: shp or kml
</code></pre>
<pre><code class="language-bash">force-tabulate-grid /data/Dagobah/edc/level2 35 60 0 20 kml
</code></pre>
<pre><code>/data/Dagobah/edc/level2/datacube-grid.kml
</code></pre>
<p>The grid can easily be loaded in GoogleEarth or any GIS. The attribute table contains the tile ID.</p>



  











<figure>


  <a data-fancybox="" href="/img/tutorial-datacube-google-grid.jpg" data-caption="Exported grid loaded in Google Earth">
<img src="/img/tutorial-datacube-google-grid.jpg" alt="" ></a>


  
  
  <figcaption>
    Exported grid loaded in Google Earth
  </figcaption>


</figure>

<h2 id="how-to-visualize-data-for-a-large-extent-more-conveniently"><strong>How to visualize data for a large extent more conveniently?</strong></h2>
<p>Whenever you use a FORCE routine, cubed data will be generated. It is a bit cumbersome to display such data for a large extent without some further treatment. The following recipe can be used for any cubed <strong>FORCE</strong> data - irrespective of processing level.</p>
<p>Lucky us, the <a href="https://gdal.org/drivers/raster/vrt.html">GDAL virtual format</a> represents an ideal concept for this. With VRTs, mosaicks of cubed data can be generated without physically copying the data. The VRT is basically a text file in xml-Format, which both holds (relative) links to the original data and the rules to assemble the mosaic on-the-fly.
<strong>FORCE</strong> comes with a tool to generate such mosaics:</p>
<pre><code class="language-bash">force-mosaic
</code></pre>
<pre><code>Usage: force-mosaic tiled-archive
</code></pre>
<pre><code class="language-bash">force-mosaic /data/Dagobah/edc/level2
</code></pre>
<p>force-mosaic searches for image files in the datacube, and mosaics all files with the same basename. The mosaics are stored in the <code>mosaic</code> subdirectory.</p>
<pre><code class="language-bash">ls /data/Dagobah/edc/level2/mosaic | head
</code></pre>
<pre><code>19840328_LEVEL2_LND05_BOA.vrt
19840328_LEVEL2_LND05_CLD.vrt
19840328_LEVEL2_LND05_HOT.vrt
19840328_LEVEL2_LND05_QAI.vrt
19840328_LEVEL2_LND05_VZN.vrt
19840409_LEVEL2_LND05_BOA.vrt
19840409_LEVEL2_LND05_CLD.vrt
19840409_LEVEL2_LND05_HOT.vrt
19840409_LEVEL2_LND05_QAI.vrt
19840409_LEVEL2_LND05_VZN.vrt
</code></pre>
<p>To speed up visualization, pyramids might be generated for the VRT files. This significantly increases loading and response times for visualization. However, pyramid layers are basically copies of the original data at reduced resolution, and as such, they consume some disc space. Consider from case to case whether fast display merits the excess disc usage. <strong>FORCE</strong> comes with a tool to generate pyramids:</p>
<pre><code class="language-bash">force-pyramid
</code></pre>
<pre><code>Usage: force-pyramid file
</code></pre>
<p>Pyramids for one file can be generated with:</p>
<pre><code class="language-bash">force-pyramid /data/Dagobah/edc/level2/mosaic/19840828_LEVEL2_LND05_BOA.vrt
</code></pre>
<pre><code>/data/Dagobah/edc/level2/mosaic/19840828_LEVEL2_LND05_BOA.vrt
computing pyramids for 19840828_LEVEL2_LND05_BOA.vrt
</code></pre>
<p>Practically, a DEFLATE compressed overview image will be stored next to the VRT:</p>
<pre><code class="language-bash">ls /data/Dagobah/edc/level2/mosaic/19840828_LEVEL2_LND05_BOA*
</code></pre>
<pre><code>/data/Dagobah/edc/level2/mosaic/19840828_LEVEL2_LND05_BOA.vrt
/data/Dagobah/edc/level2/mosaic/19840828_LEVEL2_LND05_BOA.vrt.ovr
</code></pre>
<p>Pyramids for all VRT mosaics can be parallely generated with:</p>
<pre><code class="language-bash">ls /data/Dagobah/edc/level2/mosaic/*.vrt | parallel force-pyramid {}
</code></pre>
<p>Any modern software based on GDAL (e.g. QGIS) is able to display VRTs, and can also handle the attached pyramid layers. Mosaicking is done on-the-fly, data outside of the display extent are not loaded.</p>



  











<figure>


  <a data-fancybox="" href="/img/tutorial-datacube-mosaic.jpg" data-caption="VRT mosaick loaded in QGIS">
<img src="/img/tutorial-datacube-mosaic.jpg" alt="" ></a>


  
  
  <figcaption>
    VRT mosaick loaded in QGIS
  </figcaption>


</figure>


    </div>

    





<div class="article-tags">
  
  <a class="badge badge-light" href="/tags/2020/">2020</a>
  
  <a class="badge badge-light" href="/tags/force/">FORCE</a>
  
  <a class="badge badge-light" href="/tags/lower-level/">Lower Level</a>
  
  <a class="badge badge-light" href="/tags/higher-level/">Higher Level</a>
  
  <a class="badge badge-light" href="/tags/tutorial/">Tutorial</a>
  
</div>



<div class="share-box" aria-hidden="true">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=https://davidfrantz.github.io/tutorials/force-datacube/datacube/&amp;text=FORCE%20Tutorial:%20The%20Datacube" target="_blank" rel="noopener" class="share-btn-twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=https://davidfrantz.github.io/tutorials/force-datacube/datacube/&amp;t=FORCE%20Tutorial:%20The%20Datacube" target="_blank" rel="noopener" class="share-btn-facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=FORCE%20Tutorial:%20The%20Datacube&amp;body=https://davidfrantz.github.io/tutorials/force-datacube/datacube/" target="_blank" rel="noopener" class="share-btn-email">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=https://davidfrantz.github.io/tutorials/force-datacube/datacube/&amp;title=FORCE%20Tutorial:%20The%20Datacube" target="_blank" rel="noopener" class="share-btn-linkedin">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://web.whatsapp.com/send?text=FORCE%20Tutorial:%20The%20Datacube%20https://davidfrantz.github.io/tutorials/force-datacube/datacube/" target="_blank" rel="noopener" class="share-btn-whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=https://davidfrantz.github.io/tutorials/force-datacube/datacube/&amp;title=FORCE%20Tutorial:%20The%20Datacube" target="_blank" rel="noopener" class="share-btn-weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>












  






  
  
  
    
  
  
  <div class="media author-card content-widget-hr">
    
      
      <img class="portrait mr-3" src="/authors/admin/avatar_huba61fb2ae087847d5946ab8e48bc46d6_594175_250x250_fill_q90_lanczos_center.jpg" alt="Avatar">
    

    <div class="media-body">
      <h5 class="card-title"><a href="https://davidfrantz.github.io/">David Frantz</a></h5>
      <h6 class="card-subtitle">Postdoctoral Researcher</h6>
      <p class="card-text">EO, ARD, FORCE, Data Science, Open Science</p>
      <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
    <li>
      <a href="mailto:david.frantz@geo.hu-berlin.de" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
    
    
    
    
    
    
    
      
    
    <li>
      <a href="https://scholar.google.de/citations?user=JtEWu3AAAAAJ" target="_blank" rel="noopener">
        <i class="ai ai-google-scholar"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://www.researchgate.net/profile/David_Frantz" target="_blank" rel="noopener">
        <i class="fab fa-researchgate"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="http://orcid.org/0000-0002-9292-3931" target="_blank" rel="noopener">
        <i class="fab fa-orcid"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/davidfrantz" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://twitter.com/d__frantz" target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
  
</ul>

    </div>
  </div>









  
  
  <div class="article-widget content-widget-hr">
    <h3>Related</h3>
    <ul>
      
      <li><a href="/tutorials/force-qai/qai/">FORCE Tutorial: Quality Bits a.k.a. Cloud Masks etc.</a></li>
      
      <li><a href="/tutorials/force-wvdb/wvdb/">FORCE Tutorial: Water Vapor Database</a></li>
      
    </ul>
  </div>
  



  </div>
</article>

      

    
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js" integrity="sha256-1zu+3BnLYV9LdiY85uXMzii3bdrkelyp37e0ZyTAQh0=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/r.min.js"></script>
        
      

      
      
    

    
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    
    
    
    
    <script>
      const search_config = {"indexURI":"/index.json","minLength":1,"threshold":0.3};
      const i18n = {"no_results":"No results found","placeholder":"Search...","results":"results found"};
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.3227ab49eed49815d1b4ba40154f74e7.js"></script>

    






  
  
  <div class="container">
    <footer class="site-footer">
  

  <p class="powered-by">
    © 2019-2020 David Frantz &middot; 

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" class="back-to-top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
